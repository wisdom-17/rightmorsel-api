var give_global_vars;jQuery(document).ready(function(e){function i(e){var i={symbol:give_global_vars.currency_sign,decimal:give_global_vars.decimal_separator,thousand:give_global_vars.thousands_separator,precision:give_global_vars.number_decimals,format:"before"===give_global_vars.currency_pos?"%s%v":"%v%s"};return accounting.formatMoney(e,i)}function a(e){return Math.abs(parseFloat(accounting.unformat(e,give_global_vars.decimal_separator)))}function n(e){var i=e.find(".give_fee_mode_checkbox").val(),a=!0;return e.has(".give_fee_mode_checkbox").length>=1&&0!==i&&"undefined"!==i&&(a=e.find(".give_fee_mode_checkbox").is(":checked")),a}var t=e("body"),o=e(".give-fee-message-label");o.css("display","inline-block"),t.on("change",".give_fee_mode_checkbox",function(){var i=e(this).closest("form.give-form"),a=e(this).is(":checked");d.give_fee_update(i,a,0)}).change(),t.on("give_donation_value_updated blur",".give-donation-amount .give-text-input",function(i,a,n){a||(a=e(this).closest("form.give-form"));var t="undefined"==typeof n?a.find("#give-amount").val():n;d.give_fee_update(a,!0,t)}),e(document).on("give_gateway_loaded",function(i,a,n){var t=e(i.currentTarget.activeElement).closest("form.give-form");d.give_fee_update(t,!0,0),o.css("display","inline-block")});var d={init:function(){e(".give-form-wrap").each(function(){var i=e(this).find(".give-form"),a=i.find(".give-fee-disable").val(),t=n(i),o=!!parseInt(a);e(this).find(".give-fee-message").hide(),o&&e(this).find(".give-fee-message").show(),t&&o&&d.give_fee_update(i,!0,0)})},give_fee_update:function(n,t,o){var d=n.find("input.give-gateway:radio:checked").val(),v=n.find(".give_fee_mode_checkbox").val();if(n.has(".give_fee_mode_checkbox").length>=1&&0!==v&&"undefined"!==v&&(t=n.find(".give_fee_mode_checkbox").is(":checked")),!d||!n)return!1;if(0===n.find(".give-fee-message").length)return!1;var f=n.find('input[name="give-form-id"]').val(),r=n.find(".give-final-total-amount"),s=n.find(".give-fee-message-label-text"),g=t===!0?"1":"0",u=n.find(".fee-break-down-message"),l=0===o?n.find("#give-amount").val():o,c={action:"give_fee_recovery_calculation",give_total:l,"give-form-id":f,"payment-mode":d,"give-fee-mode-enable":g};e.post(give_global_vars.ajaxurl,c,function(o){if(r.show(),u.hide(),o=e.parseJSON(o),o.fee_recovery){if(o.is_disable?(n.find(".give-fee-recovery-donors-choice").show(),n.find(".fee-coverage-required").show()):(n.find(".give-fee-recovery-donors-choice").hide(),n.find(".fee-coverage-required").hide()),o.give_fee_status?(n.find('input[name="give-fee-status"]').remove(),n.prepend('<input type="hidden" name="give-fee-status" value="enabled"/>')):(n.find('input[name="give-fee-status"]').remove(),n.prepend('<input type="hidden" name="give-fee-status" value="disabled"/>')),o.fee_breakdown){var v=u.data("breakdowntext");if("undefined"!=typeof v){var f=v.replace("{amount}",i(l)),g=f.replace("{fee_amount}",i(o.fee));u.show()}}var c=n.find(".give-fee-message-label").data("feemessage"),m=c.replace("{fee_amount}",i(o.fee));s.text(m),r.text(i(o.new_total)).attr("data-total",a(i(o.new_total))),t===!0?(n.find('input[name="give-payment-mode"]').remove(),n.prepend('<input type="hidden" name="give-payment-mode" value="'+d+'"/>'),u.text(g)):u.hide(),n.find('input[name="give-fee-mode-enable"]').remove(),n.prepend('<input type="hidden" name="give-fee-mode-enable" value="'+t+'"/>'),n.find('input[name="give-fee-amount"]').remove(),n.prepend('<input type="hidden" name="give-fee-amount" value="'+a(i(o.fee))+'"/>')}else n.find('input[name="give-fee-status"]').remove(),n.prepend('<input type="hidden" name="give-fee-status" value="disabled"/>')})}};d.init()});